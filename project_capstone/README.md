# Capstone Project - Understanding the cross-section of REIT returns

## Problem Statement

I am a portfolio manager at a real estate fund of funds, and I am intrigued by recent publications in academia on machine learning and asset pricing. According to Campbell and Thompson (2008), small improvements in R2 can lead to large improvements in performance for a mean-variance investor. They show that the proportionate increase in expected excess return earned by an active investor exploiting predictive information is a function of predictive R2 and the Sharpe ratio earned by a passive buy-and-hold investor. Sharpe ratio describes how much excess return an investor's portfolio receives for the volatility he has to endure for holding on to that portfolio, and it is how my performance as a portfolio manager is assessed by my clients. 

My job is to improve my portfolio's Sharpe ratio by finding better ways to assemble my portfolio of real estate stocks to beat a buy-and-hold portfolio such as the FTSE Nareit U.S. Real Estate Index Series. I am encouraged by the recent findings of Gu, Kelly and Xiu (2020) who state that a portfolio that executes market timing on S&P 500 stocks using neural network forecasts enjoys an annualized (out-of-sample) Sharpe ratio of 0.77, as opposed a Sharpe ratio of 0.51 enjoyed by a passive buy-and-hold investor of the S&P 500 index. This is a more than 50% improvement in the risk-return tradeoff. 

## Executive Summary

For this project, datasets containing information such as mosquitos species caught, number of mosquitoes caught, presence of WNV in the mosquitos and coordinate location of traps were used. Information on the date and location of spraying and various weather parameters were also utilized. The following summarises the analysis process:

1. Impute or remove missing or duplicated data from the train, test, weather and spray datasets

2. Merge the train and spray datasets and perform EDA on the effect of spraying on presence of WNV and number of mosquitos

3. Merge the train and weather datasets and perform feature engineering and selection by evaluating the ROC_AUC score of models against the selected features iteratively 

4. Tune the hyperparameters for 18 models by gridsearching and choose the best one based on ROC_AUC score on the train set, the CV ROC_AUC score on the train set , the ROC_AUC score on the test set and finally the Kaggle score

The best model selected was the XGBoost Classifier (Model 18) as even though it has a lower ROC_AUC than the Logistic Regression (Model 17), it has a higher sensitivity which is important because Chicago city officials might make expensive decisions on mosquito-eradication methods (spray in areas we predict to be positive, and don't spray in areas we predict to be negative). Therefore it is also important to have as high true positive as possible, and as low false negative as possible. This points to using sensitivity as a secondary metric for us to use as assessment since ROC_AUC is quite close between Models 17 and 18.

The following table summarizes the performance of all 18 models:

| Model No. | Classifier | CV Score (train) | ROC_AUC (train) | ROC_AUC (test) | Kaggle Score | Runtime (sec) |
|---|---|---|---|---|---|---|
| 1 | LogisticRegression(random_state=42, solver='liblinear') | 0.989000 | 0.994000 | 0.830000 | 0.684000 | 7 |
| 2 | KNeighborsClassifier() | 0.919000 | 1.000000 | 0.7776000 | 0.596000 | 24 |
| 4 | RandomForestClassifier(random_state=42) | 0.979000 | 0.996000 | 0.804000 | 0.643000 | 33 |
| 4 | ExtraTreesClassifier(random_state=42) | 0.989000 | 1.000000 | 0.809000 | 0.710000 | 93 |
| 5 | SVC(max_iter=10000, random_state=42) | 0.973000 | 0.981000 | 0.803000 | 0.598000 | 136 |
| 6 | XGBClassifier(base_score=None, booster=None, colsample_bylevel=None, <br>colsample_bynode=None, colsample_bytree=None, gamma=None, gpu_id=None, <br>importance_type='gain', interaction_constraints=None, learning_rate=None, <br>max_delta_step=None, max_depth=None, min_child_weight=None, missing=nan, <br>monotone_constraints=None, n_estimators=100, n_jobs=None, num_parallel_tree=None, <br>random_state=42, reg_alpha=None, reg_lambda=None, scale_pos_weight=None, <br>subsample=None, tree_method=None, validate_parameters=None, verbosity=None) | 0.992000 | 1.000000 | 0.831000 | 0.697000 | 133 |
| 7 | LogisticRegression(random_state=42) | 0.989000 | 0.994000 | 0.828000 | 0.684000 | 176 |
| 8 | XGBClassifier(base_score=None, booster=None, colsample_bylevel=None, <br>colsample_bynode=None, colsample_bytree=None, gamma=None, gpu_id=None, <br>importance_type='gain', interaction_constraints=None, learning_rate=None, <br>max_delta_step=None, max_depth=None, min_child_weight=None, missing=nan, <br>monotone_constraints=None, n_estimators=100, n_jobs=None, num_parallel_tree=None, <br>random_state=42, reg_alpha=None, reg_lambda=None, scale_pos_weight=None, <br>subsample=None, tree_method=None, validate_parameters=None, verbosity=None) | 0.991000 | 0.999000 | 0.830000 | 0.658000 | 104 |
| 9 | LogisticRegression(random_state=42, solver='liblinear') | 0.989000 | 0.994000 | 0.826000 | 0.693000 | 10 |
| 10 | XGBClassifier(base_score=None, booster=None, colsample_bylevel=None, <br>colsample_bynode=None, colsample_bytree=None, gamma=None, gpu_id=None, <br>importance_type='gain', interaction_constraints=None, learning_rate=None, <br>max_delta_step=None, max_depth=None, min_child_weight=None, missing=nan, <br>monotone_constraints=None, n_estimators=100, n_jobs=None, num_parallel_tree=None, <br>random_state=42, reg_alpha=None, reg_lambda=None, scale_pos_weight=None, subsample=None, <br>tree_method=None, validate_parameters=None, verbosity=None) | 0.990000 | 1.000000 | 0.797000 | 0.673000 | 182 |
| 11 | LogisticRegression(random_state=42, solver='liblinear') | 0.988000 | 0.993000 | 0.832000 | 0.717000 | 6 |
| 12 | XGBClassifier(base_score=None, booster=None, colsample_bylevel=None, <br>colsample_bynode=None, colsample_bytree=None, gamma=None, gpu_id=None, <br>importance_type='gain', interaction_constraints=None, learning_rate=None, <br>max_delta_step=None, max_depth=None, min_child_weight=None, missing=nan, <br>monotone_constraints=None, n_estimators=100, n_jobs=None, num_parallel_tree=None, <br>random_state=42, reg_alpha=None, reg_lambda=None, scale_pos_weight=None, <br>subsample=None, tree_method=None, validate_parameters=None, verbosity=None) | 0.990000 | 0.997000 | 0.826000 | 0.683000 | 141 |
| 13 | LogisticRegression(random_state=42, solver='liblinear') | 0.987000 | 0.992000 | 0.826000 | 0.734000 | 4 |
| 14 | XGBClassifier(base_score=None, booster=None, colsample_bylevel=None, <br>colsample_bynode=None, colsample_bytree=None, gamma=None, gpu_id=None, <br>importance_type='gain', interaction_constraints=None, learning_rate=None, <br>max_delta_step=None, max_depth=None, min_child_weight=None, missing=nan, <br>monotone_constraints=None, n_estimators=100, n_jobs=None, num_parallel_tree=None, <br>random_state=42, reg_alpha=None, reg_lambda=None, scale_pos_weight=None, subsample=None, <br>tree_method=None, validate_parameters=None, verbosity=None) | 0.992000 | 0.999000 | 0.825000 | 0.715000 | 114 |
| 15 | LogisticRegression(random_state=42, solver='liblinear') | 0.989000 | 0.993000 | 0.845000 | 0.708000 | 5 |
| 16 | XGBClassifier(base_score=None, booster=None, colsample_bylevel=None, <br>colsample_bynode=None, colsample_bytree=None, gamma=None, gpu_id=None, <br>importance_type='gain', interaction_constraints=None, learning_rate=None, <br>max_delta_step=None, max_depth=None, min_child_weight=None, missing=nan, <br>monotone_constraints=None, n_estimators=100, n_jobs=None, num_parallel_tree=None, <br>random_state=42, reg_alpha=None, reg_lambda=None, scale_pos_weight=None, subsample=None, <br>tree_method=None, validate_parameters=None, verbosity=None) | 0.990000 | 0.997000 | 0.829000 | 0.690000 | 118 |
| 17 | LogisticRegression(random_state=42, solver='liblinear') | 0.990000 | 0.994000 | 0.849000 | 0.725000 | 9 |
| 18 | XGBClassifier(base_score=None, booster=None, colsample_bylevel=None, <br>colsample_bynode=None, colsample_bytree=None, gamma=None, gpu_id=None, <br>importance_type='gain', interaction_constraints=None, learning_rate=None, <br>max_delta_step=None, max_depth=None, min_child_weight=None, missing=nan, <br>monotone_constraints=None, n_estimators=100, n_jobs=None, num_parallel_tree=None, <br>random_state=42, reg_alpha=None, reg_lambda=None, scale_pos_weight=None, subsample=None, <br>tree_method=None, validate_parameters=None, verbosity=None) | 0.991000 | 0.999000 | 0.843000 | 0.704000 | 129 |
|  |  |  |  |  |  |  |


## Data Dictionary

| Feature | Type | Dataset | Description |
|---|---|---|---|
| Id | Integer | Test | The id of the record |
| Date | Object | Train/Test/Weather | Date that the WNV test is performed for Train/TestDate of weather measurement for Weather |
| Address | Object | Train/Test | Approximate address of the location of trap. This is used to send to the GeoCoder. |
| Species | Object | Train/Test | The species of mosquitos |
| Block | Integer | Train/Test | Block number of address |
| Street | Object | Train/Test | Street name |
| Trap | Object | Train/Test | Id of the trap |
| AddressNumberAndStreet | Object | Train/Test | Approximate address returned from GeoCoder |
| Latitude | Float | Train/Test/Spray | Latitude returned from GeoCoder for Train/Test <br>Latitude of the spray |
| Longitude | Float | Train/Test/Spray | Longitude returned from GeoCoder for Train/Test<br>Longitude of the spray |
| AddressAccuracy | Integer | Train/Test | Accuracy returned from GeoCoder |
| NumMosquitos | Integer | Train | Number of mosquitoes caught in this trap |
| WnvPresent | Integer | Train | Whether West Nile Virus was present in these mosquitos. <br>1 means WNV is present, and 0 means not present. |
| Station | Integer | Weather | 1; automated station without a precipitation descriminator. <br>2; automated station with precipitation descriminator. |
| Tmax | Integer | Weather | Maximum Temperature |
| Tmin | Integer | Weather | Minimum Temperature |
| Tavg | Integer | Weather | Average Temperature |
| Depart | Integer | Weather | Departure from normal |
| Dewpoint | Integer | Weather | Average dew point |
| Wetbulb | Integer | Weather | Average wet bulb |
| Heat | Integer | Weather | Heating (Season begins with July) |
| Cool | Integer | Weather | Cooling (Season begins with January) |
| Sunrise | Object | Weather | Sunrise Time (Calculated, not observed) |
| Sunset | Object | Weather | Sunset Time (Calculated, not observed) |
| CodeSum | Object | Weather | Significant Weather Types<br><br>+FC TORNADO/WATERSPOUT<br> FC  FUNNEL CLOUD<br> TS  THUNDERSTORM<br> GR  HAIL<br>RA RAIN<br>DZ DRIZZLE<br>SN SNOW<br>SG SNOW GRAINS<br>GS SMALL HAIL &/OR SNOW PELLETS<br>PL ICE PELLETS<br>IC ICE CRYSTALS<br>FG+ HEAVY FOG (FG & LE.25 MILES VISIBILITY) FG FOG<br>BR MIST<br>UP UNKNOWN PRECIPITATION<br>HZ HAZE<br>FU SMOKE<br>VA VOLCANIC ASH<br>DU WIDESPREAD DUST<br>DS DUSTSTORM<br>PO SAND/DUST WHIRLS<br>SA SAND<br>SS SANDSTORM<br>PY SPRAY<br>SQ SQUALL<br>DR LOW DRIFTING<br>SH SHOWER<br>FZ FREEZING<br>MI SHALLOW<br>PR PARTIAL<br>BC PATCHES<br>BL BLOWING<br>VC VICINITY<br>- LIGHT + HEAVY<br>"NO SIGN" MODERATE |
| Depth | Integer | Weather | Depth of snow/ice in inches SNOW/ICE (ON GROUND)(1200 UTC)T = TRACEM = MISSING DATA |
| Water1 | Integer | Weather | WATER EQUIVALENT (1800 UTC) M = MISSING DATA |
| SnowFall | Float | Weather | SNOWFALL (INCHES AND TENTHS)(2400 LST)*<br>T = TRACEM = MISSING DATA |
| PrecipTotal | Float | Weather | WATER EQUIVALENT(INCHES & HUNDREDTHS(2400 LST) RAINFALL & MELTED SNOW<br>M = MISSING DATAT = TRACE |
| StnPressure | Float | Weather | Pressure in inches |
| SeaLevel | Float | Weather | Average Sea Level Pressure |
| ResultSpeed | Float | Weather | Resultant Wind Speed |
| ResultDir | Integer | Weather | Resultant Wind Direction (Whole Degree) |
| AvgSpeed | Float | Weather | Wing Average Speed |


	Feature acronym	Original author(s)	Date, journal	Description of feature
0	absacc	Bandyopadhyay, Huang, and Wirjanto	2010, WP	Absolute value ofacc
1	acc	Sloan	1996, TAR	Annual income before extraordinary items (ib) ...
2	aeavol	Lerman, Livnat, and Mendenhall	2008, WP	Average daily trading volume (vol) for 3 days ...
3	age	Jiang, Lee, and Zhang	2005, RAS	Number of years since first Compustat coverage
4	agr	Cooper, Gulen, and Schill	2008, JF	Annual percent change in total assets (at)
5	baspread	Amihud and Mendelson	1989, JF	Monthly average of daily bid-ask spread divide...
6	beta	Fama and MacBeth	1973, JPE	Estimated market beta from weekly returns and ...
7	betasq	Fama and MacBeth	1973, JPE	Market beta squared
8	bm	Rosenberg, Reid, and Lanstein	1985, JPM	Book value of equity (ceq) divided by end of f...
9	bm_ia	Asness, Porter, and Stevens	2000, WP	Industry adjusted book-to-market ratio
10	cash	Palazzo	2012, JFE	Cash and cash equivalents divided by average t...
11	cashdebt	Ou and Penman	1989, JAE	Earnings before depreciation and extraordinary...
12	cashpr	Chandrashekar and Rao	2009, WP	Fiscal year-end market capitalization plus lon...
13	cfp	Desai, Rajgopal, and Venkatachalam	2004, TAR	Operating cash flows divided by fiscal-year-en...
14	cfp_ia	Asness, Porter and Stevens	2000, WP	Industry adjustedcfp
15	chatoia	Soliman	2008, TAR	2-digit SIC - fiscal-year mean-adjusted change...
16	chcsho	Pontiff and Woodgate	2008, JF	Annual percent change in shares outstanding (c...
17	chempia	Asness, Porter, and Stevens	1994, WP	Industry-adjusted change in number of employees
18	chfeps	Hawkins, Chamberlin, and Daniel	1984, FAJ	Mean analyst forecast in month prior to fiscal...
19	chinv	Thomas and Zhang	2002, RAS	Change in inventory (inv) scaled by average to...
20	chmom	Gettleman and Marks	2006, WP	Cumulative returns from months| ùë° |-6 to| ùë° |-...
21	chnanalyst	Scherbina	2008 RF	Change innanalystfrom month| ùë° |-3 to month| ùë° |
22	chpmia	Soliman	2008, TAR	2-digit SIC - fiscal-year mean adjusted change...
23	chtx	Thomas and Zhang	2011, JAR	Percent change in total taxes (txtq) from quar...
24	cinvest	Titman, Wei, and Xie	2004, JFQA	Change over one quarter in net PP&E (ppentq) d...
25	convind	Valta	2016, JFQA	An indicator equal to 1 if company has convert...
26	currat	Ou and Penman	1989, JAE	Current assets / current liabilities
27	depr	Holthausen and Larcker	1992, JAE	Depreciation divided by PP&E
28	disp	Diether, Malloy, and Scherbina	2002, JF	Standard deviation of analyst forecasts in mon...
29	divi	Michaely, Thaler, and Womack	1995, JF	An indicator variable equal to 1 if company pa...
30	divo	Michaely, Thaler, and Womack	1995, JF	An indicator variable equal to 1 if company do...
31	dolvol	Chordia, Subrahmanyam, and Anshuman	2001, JFE	Natural log of trading volume times price per ...
32	dy	Litzenberger and Ramaswamy	1982, JF	Total dividends (dvt) divided by market capita...
33	ear	Kishore et al.	2008, WP	Sum of daily returns in three days around earn...
34	egr	Richardson et al.	2005, JAE	Annual percent change in book value of equity ...
35	ep	Basu	1977, JF	Annual income before extraordinary items (ib) ...
36	fgr5yr	Bauman and Dowen	1988, FAJ	Most recently available analyst forecasted 5-y...
37	gma	Novy-Marx	2013, JFE	Revenues (revt) minus cost of goods sold (cogs...
38	grCAPX	Anderson and Garcia-Feijoo	2006, JF	Percent change in capital expenditures from ye...
39	grltnoa	Fairfield, Whisenant, and Yohn	2003, TAR	Growth in long-term net operating assets
40	herf	Hou and Robinson	2006, JF	2-digit SIC - fiscal-year sales concentration ...
41	hire	Bazdresch, Belo, and Lin	2014, JPE	Percent change in number of employees (emp)
42	idiovol	Ali, Hwang, and Trombley	2003, JFE	Standard deviation of residuals of weekly retu...
43	ill	Amihud	2002, JFM	Average of daily (absolute return / dollar vol...
44	indmom	Moskowitz and Grinblatt	1999, JF	Equal weighted average industry 12-month returns
45	invest	Chen and Zhang	2010, JF	Annual change in gross property, plant, and eq...
46	IPO	Loughran and Ritter	1995, JF	An indicator variable equal to 1 if first year...
47	lev	Bhandari	1988, JF	Total liabilities (lt) divided by fiscal year-...
48	lgr	Richardson et al.	2005, JAE	Annual percent change in total liabilities (lt)
49	maxret	Bali, Cakici, and Whitelaw	2011, JFE	Maximum daily return from returns during calen...
50	mom12m	Jegadeesh	1990, JF	11-month cumulative returns ending one month b...
51	mom1m	Jegadeesh and Titman	1993, JF	1-month cumulative return
52	mom36m	Jegadeesh and Titman	1993, JF	Cumulative returns from months| ùë° |-36 to| ùë° ...
53	mom6m	Jegadeesh and Titman	1993, JF	5-month cumulative returns ending one month be...
54	ms	Mohanram	2005, RAS	Sum of 8 indicator variables for fundamental p...
55	mve	Banz	1981, JFE	Natural log of market capitalization at end of...
56	mve_ia	Asness, Porter, and Stevens	2000, WP	2-digit SIC industry-adjusted fiscal year-end ...
57	nanalyst	Elgers, Lo, and Pfeiffer	2001, TAR	Number of analyst forecasts from most recently...
58	nincr	Barth, Elliott, and Finn	1999, JAR	Number of consecutive quarters (up to eight qu...
59	operprof	Fama and French	2015, JFE	Revenue minus cost of goods sold - SG&A expens...
60	orgcap	Eisfeldt and Papanikolaou	2013, JF	Capitalized SG&A expenses
61	pchcapx_ia	Abarbanell and Bushee	1998, TAR	2-digit SIC - fiscal-year mean-adjusted percen...
62	pchcurrat	Ou and Penman	1989, JAE	Percent change incurrat.
63	pchdepr	Holthausen and Larcker	1992, JAE	Percent change indepr
64	pchgm_pchsale	Abarbanell and Bushee	1998, TAR	Percent change in gross margin (sale-cogs) min...
65	pchquick	Ou and Penman	1989, JAE	Percent change inquick
66	pchsale_pchinvt	Abarbanell and Bushee	1998, TAR	Annual percent change in sales (sale) minus an...
67	pchsale_pchrect	Abarbanell and Bushee	1998, TAR	Annual percent change in sales (sale) minus an...
68	pchsale_pchxsga	Abarbanell and Bushee	1998, TAR	Annual percent change in sales (sale) minus an...
69	pchsaleinv	Ou and Penman	1989, JAE	Percent change insaleinv
70	pctacc	Hafzalla, Lundholm, and Van Winkle	2011, TAR	Same asaccexcept that the numerator is divided...
71	pricedelay	Hou & Moskowitz	2005, RFS	The proportion of variation in weekly returns ...
72	ps	Piotroski	2000, JAR	Sum of 9 indicator variables to form fundament...
73	quick	Ou and Penman	1989, JAE	(current assets - inventory) / current liabili...
74	rd	Eberhart, Maxwell, and Siddique	2004, JF	An indicator variable equal to 1 if R&D expens...
75	rd_mve	Guo, Lev, and Shi	2006, JBFA	R&D expense divided by end-of-fiscal-year mark...
76	rd_sale	Guo, Lev, and Shi	2006, JBFA	R&D expense divided by sales (xrd/sale)
77	realestate	Tuzel	2010, RFS	Buildings and capitalized leases divided by gr...
78	retvol	Ang et al.	2006, JF	Standard deviation of daily returns from month...
79	roaq	Balakrishnan, Bartov, and Faurel	2010, JAE	Income before extraordinary items (ibq) divide...
80	roavol	Francis et al.	2004, TAR	Standard deviation for 16 quarters of income b...
81	roeq	Hou, Xue, and Zhang	2015 RFS	Earnings before extraordinary items divided by...
82	roic	Brown and Rowe	2007, WP	Annual earnings before interest and taxes (ebi...
83	rsup	Kama	2009, JBFA	Sales from quarter t minus sales from quarter|...
84	salecash	Ou and Penman	1989, JAE	Annual sales divided by cash and cash equivalents
85	saleinv	Ou and Penman	1989, JAE	Annual sales divided by total inventory
86	salerec	Ou and Penman	1989, JAE	Annual sales divided by accounts receivable
87	secured	Valta	2016, JFQA	Total liability scaled secured debt
88	securedind	Valta	2016, JFQA	An indicator equal to 1 if company has secured...
89	sfe	Elgers, Lo, and Pfeiffer	2001, TAR	Analysts mean annual earnings forecast for nea...
90	sgr	Lakonishok, Shleifer, and Vishny	1994, JF	Annual percent change in sales (sale)
91	sin	Hong & Kacperczyk	2009, JFE	An indicator variable equal to 1 if a company‚Äô...
92	SP	Barbee, Mukherji, and Raines	1996, FAJ	Annual revenue (sale) divided by fiscal year-e...
93	std_dolvol	Chordia, Subrahmanyam, and Anshuman	2001, JFE	Monthly standard deviation of daily dollar tra...
94	std_turn	Chordia, Subrahmanyam, and Anshuman	2001, JFE	Monthly standard deviation of daily share turn...
95	stdacc	Bandyopadhyay, Huang, and Wirjanto	2010, WP	Standard deviation for 16 quarters of accruals...
96	stdcf	Huang	2009, JEF	Standard deviation for 16 quarters of cash flo...
97	sue	Rendelman, Jones, and Latane	1982, JFE	Unexpected quarterly earnings divided by fisca...
98	tang	Almeida and Campello	2007, RFS	Cash holdings| + |0.715| √ó |receivables|$...
99	tb	Lev and Nissim	2004, TAR	Tax income, calculated from current tax expens...
100	turn	Datar, Naik, and Radcliffe	1998, JFM	Average monthly trading volume for most recent...
101	zerotrade	Liu	2006, JFE	Turnover
